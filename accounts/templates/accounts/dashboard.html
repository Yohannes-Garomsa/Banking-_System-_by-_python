{% extends 'base.html' %}
{% block content %}

<style>
    /* Professional Pulse Animation */
    .pulse-status {
        animation: pulse-blue 2s infinite;
        border-radius: 5px;
    }

    @keyframes pulse-blue {
        0% { box-shadow: 0 0 0 0 rgba(13, 202, 240, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(13, 202, 240, 0); }
        100% { box-shadow: 0 0 0 0 rgba(13, 202, 240, 0); }
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
</style>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-4">
            <div class="card bg-dark text-white p-3 border-success shadow glass-card">
                <h4>Welcome, {{ request.user.username }}!</h4>
                <hr class="bg-success">
                <p>Status: 
                    {% if account.is_verified %}
                        <span class="badge bg-success text-white">ACTIVE CUSTOMER</span>
                    {% elif account.kyc_step == 3 %}
                        <span class="badge bg-info text-dark pulse-status">PENDING APPROVAL</span>
                    {% else %}
                        <span class="badge bg-warning text-dark">INCOMPLETE KYC</span>
                    {% endif %}
                </p>
                <p class="mb-0 text-muted">Occupation: {{ account.occupation|default:"Not set"|title }}</p>
            </div>
        </div>

        <div class="col-md-8">
            {% if account.is_verified %}
                <div class="card p-5 bg-dark text-white border-success shadow">
                    <h5 class="text-uppercase text-muted">Total Available Balance</h5>
                    <h1 class="display-4 text-success fw-bold">${{ account.balance }}</h1>
                    <div class="mt-4">
                        <button class="btn btn-success btn-lg me-2 px-4 shadow-sm" data-bs-toggle="modal" data-bs-target="#transferModal">
                            <i class="bi bi-arrow-left-right"></i> Transfer
                        </button>
                        <button class="btn btn-outline-light btn-lg px-4">
                            <i class="bi bi-clock-history"></i> History
                        </button>
                    </div>
                </div>

            {% elif account.kyc_step == 3 %}
                <div class="alert alert-info bg-dark border-info p-5 shadow glass-card">
                    <div class="text-center">
                        <div class="spinner-grow text-info mb-3" role="status"></div>
                        <h2 class="text-info fw-bold">Verification in Progress</h2>
                        <p class="lead">Your documents have been received. The compliance team is currently reviewing your identity.</p>
                        <div class="progress bg-secondary mt-4" style="height: 10px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" style="width: 75%"></div>
                        </div>
                        <p class="mt-3 text-muted">Estimated time: 2-4 business hours</p>
                    </div>
                </div>

            {% else %}
                <div class="alert alert-warning bg-dark border-warning p-5 shadow">
                    <h4 class="alert-heading fw-bold"><i class="bi bi-exclamation-triangle"></i> Action Required</h4>
                    <p>Your banking features are currently locked. Please complete the remaining steps of your identity verification.</p>
                    <hr class="border-warning">
                    <a href="{% url 'verify_identity' %}" class="btn btn-warning fw-bold px-5">
                        RESUME VERIFICATION (Step {{ account.kyc_step }})
                    </a>
                </div>
            {% endif %}

            {% if my_history %}
            <div class="mt-4">
                <h5 class="text-white mb-3">Recent Activity</h5>
                <div class="list-group shadow">
                    {% for tx in my_history|slice:":5" %}
                    <div class="list-group-item bg-dark text-white border-secondary d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted d-block">{{ tx.timestamp|date:"M d, Y" }}</small>
                            <span>{{ tx.get_tx_type_display }}</span>
                        </div>
                        <span class="{% if tx.receiver == account.owner %}text-success{% else %}text-danger{% endif %} fw-bold">
                            {% if tx.receiver == account.owner %}+{% else %}-{% endif %}${{ tx.amount }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}