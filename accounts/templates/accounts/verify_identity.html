{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <div class="scanner-box p-4 bg-dark text-white text-center">
        <div class="scanner-line"></div>
        <h2 class="text-success fw-bold">ID SCANNER</h2>
        <p>Align your National ID within the frame</p>
        
        <video id="video" width="100%" autoplay class="rounded border border-success"></video>
        <canvas id="canvas" style="display:none;"></canvas>
        
        <div class="mt-3">
            <button id="snap" class="btn btn-success btn-lg px-5">CAPTURE ID</button>
        </div>
        
        <form id="verify-form" method="POST" class="mt-3">
            {% csrf_token %}
            <input type="hidden" name="id_image" id="id_image">
            <button type="submit" id="submit-btn" class="btn btn-warning d-none">UPLOAD TO BANK VAULT</button>
        </form>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const snap = document.getElementById('snap');
    const idInput = document.getElementById('id_image');
    const submitBtn = document.getElementById('submit-btn');

    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; });

    snap.addEventListener('click', () => {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        const dataUrl = canvas.toDataURL('image/png');
        idInput.value = dataUrl;
        
        snap.innerText = "RE-TAKE PHOTO";
        submitBtn.classList.remove('d-none');
        alert("ID Captured Successfully!");
    });
</script>
{% endblock %}